(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-488659c6","chunk-2d0b9bf2"],{"14d1":function(t,e,a){},"15ff":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-firmware"},[e("div",[t._v(" "+t._s("已关联固件(".concat(t.firmwareRows.length,"个)"))+" ")]),t.moduleIds.length?e("a-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{message:"温馨提示：一个类型的包，只能选择一个",type:"warning",banner:""}}):e("a-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{message:"请先选择模组",type:"warning",banner:""}}),e("a-table",{attrs:{size:"small",rowKey:"id",loading:t.loading,"data-source":t.firmwareData,columns:t.firmwareColumns,"row-selection":t.disabled?{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange,getCheckboxProps:function(){return{props:{disabled:!0}}}}:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},pagination:t.pagination},on:{change:t.onChangePagination},scopedSlots:t._u([{key:"type",fn:function(a,i){return[e("div",[t._v(t._s(t.$DictName("firmware_type",i.type)))])]}},{key:"flashSize",fn:function(a,i){return[e("div",[t._v(t._s(t.$DictName("flash_size",i.flashSize)))])]}}])})],1)},r=[],o=a("2909"),n=(a("99af"),a("d81d"),a("4de4"),a("d3b7"),a("caad"),a("2532"),a("c4c8")),s={props:{formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1},moduleIds:{type:Array,default:[]}},data:function(){return{pagination:{showSizeChanger:!0,current:1,pageSize:10,total:0,showTotal:function(t,e){return"总数:".concat(t," 当前:").concat(e[0],"-").concat(e[1])}},queryParam:{page:1,limit:10,query:{status:1}},loading:!1,firmwareData:[],firmwareColumns:[{dataIndex:"name",title:"固件名称",ellipsis:!0},{dataIndex:"version",title:"版本号",ellipsis:!0},{dataIndex:"type",title:"固件类型",scopedSlots:{customRender:"type"},ellipsis:!0},{dataIndex:"flag",title:"标识",ellipsis:!0},{dataIndex:"id",title:"固件key",ellipsis:!0},{dataIndex:"flashSize",title:"大小",scopedSlots:{customRender:"flashSize"}},{dataIndex:"remark",title:"固件描述"}],selectedRowKeys:[],firmwareRows:[]}},watch:{moduleIds:{handler:function(t,e){this.firmwareData=[],this.firmwareRows=[],this.selectedRowKeys=[],t&&t.length&&(this.queryParam.query.moduleIds=t,this.init())},immediate:!0},formData:{handler:function(t,e){t&&t.id&&t.firmwareIds&&(this.firmwareRows=t.firmwareIds.map((function(t){return{id:t}})),this.selectedRowKeys=t.firmwareIds)},immediate:!0}},methods:{onChangePagination:function(t){this.queryParam.limit=t.pageSize,this.queryParam.page=t.current,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.init()},init:function(){var t=this;this.loading=!0,Object(n["D"])(this.queryParam).then((function(e){0===e.code?(t.firmwareData=e.data.list,t.pagination.total=e.data.total):t.toast(e),t.loading=!1}))},onSelectChange:function(t,e,a){this.firmwareRows=[].concat(Object(o["a"])(this.firmwareRows),Object(o["a"])(e));var i=e.map((function(t){return t.id})),r=this.firmwareData.filter((function(t){return!i.includes(t.id)})),n=r.map((function(t){return t.id}));this.firmwareRows=this.firmwareRows.filter((function(t){return!n.includes(t.id)})),this.firmwareRows=this.removeDuplicate(this.firmwareRows),this.selectedRowKeys=this.firmwareRows.map((function(t){return t.id}))},removeDuplicate:function(t){var e={};return t=t.reduce((function(t,a){return!e[a.id]&&(e[a.id]=t.push(a)),t}),[]),t}}},l=s,d=a("2877"),c=Object(d["a"])(l,i,r,!1,null,"1cb8009a",null);e["default"]=c.exports},"191a":function(t,e,a){"use strict";a("14d1")},"2bf6":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[t._l(t.networkGuides,(function(a,i){return e("div",{key:i,staticClass:"networkGuide-data"},[2!=a.type?e("a-checkbox",{attrs:{disabled:t.disabled},model:{value:a.bl,callback:function(e){t.$set(a,"bl",e)},expression:"v.bl"}},[e("div",{staticClass:"networkGuide-text"},[t._v(" "+t._s(t.$DictName("network_guide",a.type))+" ")]),e("a-button",{attrs:{type:"primary",disabled:!a.bl},on:{click:function(e){return t.selectNetworkGuide(a,i)}}},[t._v(" 配网文案 ")])],1):t._e()],1)})),e("a-modal",{attrs:{title:"配网文案",width:640,visible:t.visible,"confirm-loading":t.confirmLoading},on:{cancel:t.handleCancel},scopedSlots:t._u([{key:"footer",fn:function(){return[e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("取消")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-button",{key:"submit",attrs:{type:"primary",loading:t.confirmLoading},on:{click:t.handleOk}},[t._v(" 确定 ")])]},proxy:!0}])},[e("a-spin",{attrs:{spinning:t.confirmLoading}},[e("div",{staticClass:"modal-content"},[t._l(t.netList.steps,(function(a,i){return e("div",{key:i},[e("div",{staticClass:"writer-header"},[e("div",[t._v("步骤"+t._s(i+1))]),e("a-button",{attrs:{type:"danger",shape:"circle",icon:"delete",disabled:t.disabled},on:{click:function(e){return t.deleteWriter(i)}}})],1),e("a-form-model",{ref:"ruleForm",refInFor:!0,attrs:{rules:t.rules,model:a}},[e("a-row",[e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,label:"中文文案",prop:"instruction"}},[e("a-input",{attrs:{disabled:t.disabled},model:{value:a.instruction,callback:function(e){t.$set(a,"instruction",e)},expression:"v.instruction"}})],1)],1),e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,label:"英文文案",prop:"instructionEn"}},[e("a-input",{attrs:{disabled:t.disabled},model:{value:a.instructionEn,callback:function(e){t.$set(a,"instructionEn",e)},expression:"v.instructionEn"}})],1)],1),e("a-col",{attrs:{span:24}},[e("a-form-model-item",{attrs:{"label-col":t.labelCol,"wrapper-col":t.wrapperCol,label:"图片视频",prop:"fileList"}},[e("a-upload",{attrs:{name:"listimg","list-type":"picture-card",accept:".jpg,.png,.gif,.jpeg,.bmp,.mp4",disabled:t.disabled,"show-upload-list":!1,customRequest:t.handleUploadImg,fileList:a.fileList,"before-upload":t.handleBeforeUpload},on:{change:function(e){return t.handleChange(i,e)}}},[a.imageUrl?e("img",{staticStyle:{width:"200px"},attrs:{src:a.imageUrl,alt:"avatar"}}):e("video",{staticStyle:{width:"200px"},attrs:{src:a.videoUrl}}),a.fileList.length<1?e("div",[e("a-icon",{attrs:{type:"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" "+t._s(t.$t("dicItem.upload"))+" ")])],1):t._e()]),e("div",{staticClass:"upload-hint"},[t._v(" 图片： 建议尺寸800px*600px，不超过300K，支持.jpg .bmp .jpeg .png .gif格式 ")]),e("div",{staticClass:"upload-hint"},[t._v(" 视频： 建议尺寸600px*450px，不超过500K，不超过15秒，支持.mp4格式 ")])],1)],1)],1)],1)],1)})),t.netList.steps.length<4?e("a-button",{attrs:{block:"",icon:"push",disabled:t.disabled},on:{click:t.addWriter}},[t._v(" 添加步骤 ")]):t._e(),t.netList.steps.length>=4?e("a-alert",{attrs:{message:"配网文案上限为四条",banner:""}}):t._e()],2)])],1)],2)},r=[],o=a("c7eb"),n=a("1da1"),s=a("5530"),l=(a("4e82"),a("d3b7"),a("159b"),a("a434"),a("b64b"),a("c4c8")),d=a("61f7"),c={props:{formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1}},data:function(){return{networkGuides:[],rules:{instruction:Object(d["b"])(1,200,"请输入1-200的中文文案"),instructionEn:Object(d["b"])(1,200,"请输入1-200的英文文案"),fileList:[{type:"array",required:!0,message:"请上传图片或视频"}]},visible:!1,confirmLoading:!1,writerForm:{instruction:"",instructionEn:"",imageUrl:"",videoUrl:"",fileList:[],sort:""},fileList:[],labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}},fileIndex:null,netType:null,netList:{steps:[]},editNet:[]}},created:function(){this.init()},watch:{formData:function(t,e){this.init()}},methods:{selectNetworkGuide:function(t,e){this.netType=t.type,this.netList=t,this.netList.steps.sort((function(t,e){return t.sort-e.sort})),this.netList.steps.forEach((function(t){t.fileList=[{uid:"1",name:t.imageUrl||t.videoUrl,status:"done",url:t.imageUrl||t.videoUrl}]})),this.visible=!0},init:function(){var t=this;Object(l["F"])().then((function(e){e.data&&(e.data.forEach((function(t){t.bl=!1})),t.networkGuides=e.data||[],t.formData&&t.formData.id&&e.data.forEach((function(e,a){t.formData.networkGuides.forEach((function(i){i&&i.type===e.type&&t.networkGuides.splice(a,1,Object(s["a"])(Object(s["a"])({},i),{},{bl:!0}))}))})))}))},handleOk:function(){var t=this,e=!1;this.netList.steps.some((function(a,i){return t.$refs["ruleForm"][i].validate((function(t){e=!t})),e})),e||(this.networkGuides.forEach((function(e){t.netType==e.type&&(e=t.netList)})),this.visible=!1)},handleCancel:function(){this.visible=!1},handleUploadImg:function(t){var e=this;return Object(n["a"])(Object(o["a"])().mark((function a(){var i,r;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.file,e.confirmLoading=!0,a.next=4,e.$UploadFile({file:i,dir:"networkGuide"});case 4:r=a.sent,r&&0==r.code?e.isImg(i.type)?(e.netList.steps[e.fileIndex].imageUrl=r.data.fullPath,e.netList.steps[e.fileIndex].videoUrl=""):e.isVideo(i.type)?(e.netList.steps[e.fileIndex].videoUrl=r.data.fullPath,e.netList.steps[e.fileIndex].imageUrl=""):(e.netList.steps[e.fileIndex].fileList=[],e.$message.warning("文件格式有误")):(e.netList.steps[e.fileIndex].fileList=[],e.netList.steps[e.fileIndex].imageUrl="",e.netList.steps[e.fileIndex].videoUrl="",e.$message.error("上传失败")),e.confirmLoading=!1;case 7:case"end":return a.stop()}}),a)})))()},handleBeforeUpload:function(t){var e=this;return new Promise((function(a,i){var r="image/jpg"===t.type||"image/png"===t.type||"image/bmp"===t.type||"image/gif"===t.type||"image/jpeg"===t.type||"video/mp4"===t.type;return r?e.isImg(t.type)&&t.size/1024/1024>.3?(e.$message.warning("上传图片最大300k"),i(!1)):e.isVideo(t.type)&&t.size/1024/1024>.5?(e.$message.warning("上传视频最大500k"),i(!1)):a(!0):(e.$message.warning("请选择.jpg,.png,.bmp,.jpeg,.gif图片或者,mp4视频"),i(!1))}))},handleChange:function(t,e){var a=e.fileList;this.fileIndex=t,this.netList.steps[this.fileIndex].fileList=a},addWriter:function(){var t=this,e=JSON.parse(JSON.stringify(this.writerForm));this.netList.steps.length>0?this.$refs["ruleForm"][this.netList.steps.length-1].validate((function(a){a&&t.netList.steps.push(Object(s["a"])(Object(s["a"])({},e),{},{sort:t.netList.steps.length+1}))})):this.netList.steps.push(Object(s["a"])(Object(s["a"])({},e),{},{sort:1}))},deleteWriter:function(t){var e=this;this.$Delete(this,"").then((function(a){e.netList.steps.splice(t,1),e.netList.steps.forEach((function(t,e){t["sort"]=e+1}))}))},isImg:function(t){return"image/jpeg"===t||"image/png"===t||"image/gif"===t||"image/jpg"===t||"image/bmp"===t},isVideo:function(t){return"video/mp4"===t}}},u=c,p=(a("b006"),a("2877")),m=Object(p["a"])(u,i,r,!1,null,"3a879d37",null);e["default"]=m.exports},"33ea":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-scene-condition"},[t.instructList.length?e("a-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{message:"温馨提示：为更合理的设置场景，数据传输类型为“可上报”的仅可以作为触发条件，“可下发”的仅可以作为执行任务",type:"warning",banner:""}}):e("a-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{message:"请先选择控制指令",type:"warning",banner:""}}),e("a-table",{attrs:{size:"small",rowKey:"id",pagination:!1,"data-source":t.instructData,columns:t.instructColumns},scopedSlots:t._u([{key:"triggerCond",fn:function(a,i,r){return["READ"===i.rwFlag||"READ_WRITE"===i.rwFlag?e("a-checkbox",{attrs:{disabled:t.disabled},on:{change:function(e){return t.onChangeCheckbox(e,r,"triggerCond")}},model:{value:i.triggerCond,callback:function(e){t.$set(i,"triggerCond",e)},expression:"item.triggerCond"}}):e("div",[t._v("不可配置")])]}},{key:"execCond",fn:function(a,i,r){return["WRITE"===i.rwFlag||"READ_WRITE"===i.rwFlag?e("a-checkbox",{attrs:{disabled:t.disabled},on:{change:function(e){return t.onChangeCheckbox(e,r,"execCond")}},model:{value:i.execCond,callback:function(e){t.$set(i,"execCond",e)},expression:"item.execCond"}}):e("div",[t._v("不可配置")])]}}])})],1)},r=[],o={props:{instructList:{type:Array,default:[]},formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1}},data:function(){return{instructData:[],instructColumns:[{dataIndex:"funcName",title:"功能点"},{dataIndex:"desc",title:"功能描述",ellipsis:!0},{dataIndex:"triggerCond",title:"触发条件",scopedSlots:{customRender:"triggerCond"}},{dataIndex:"execCond",title:"执行任务",scopedSlots:{customRender:"execCond"}}]}},watch:{instructList:{handler:function(t,e){t&&t.length?this.instructData=t:this.instructData=[]},immediate:!0}},methods:{onChangeCheckbox:function(t,e,a){this.instructData[e][a]=t.target.checked,this.$forceUpdate()}}},n=o,s=a("2877"),l=Object(s["a"])(n,i,r,!1,null,"6d07b5f3",null);e["default"]=l.exports},"3e8f":function(t,e){},4788:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-control-instruction"},[t.productTypeId?t._e():e("a-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{message:"请先选择产品分类",type:"warning",banner:""}}),e("a-table",{attrs:{size:"small",rowKey:"id",pagination:!1,loading:t.loading,"data-source":t.instructData,columns:t.instructColumns,"row-selection":t.disabled?null:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange,getCheckboxProps:t.getCheckboxProps}},scopedSlots:t._u([{key:"required",fn:function(a,i){return[e("div",[t._v(t._s(t.$DictName("yes_no",i.required)))])]}}])})],1)},r=[],o=(a("d3b7"),a("d81d"),a("4de4"),a("c4c8")),n={props:{productTypeId:{type:String,default:""},formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1},whetherProductKey:{type:Boolean,default:!1}},data:function(){return{instructData:[],instructColumns:[{dataIndex:"dpid",title:"dpid"},{dataIndex:"funcName",title:"功能点"},{dataIndex:"required",title:"必选",width:"50px",scopedSlots:{customRender:"required"}},{dataIndex:"identifier",title:"标识符"},{dataIndex:"rwFlag",title:"数据传输类型"},{dataIndex:"dataType",title:"数据类型",width:"80px"},{dataIndex:"attribute",title:"功能点属性",width:"340px"}],instructRows:[],selectedRowKeys:[],loading:!1,mustList:[]}},created:function(){},computed:{disabledForm:function(){var t=this;return 0===this.instructRows.length||this.mustList.some((function(e){return!t.instructRows.some((function(t){return t.id===e.id}))}))}},watch:{productTypeId:{handler:function(t,e){this.init()},immediate:!0},formData:{handler:function(t,e){t&&t.id&&(this.instructRows=t.thingModels||[],this.selectedRowKeys=this.instructRows.map((function(t){return t.id})))},immediate:!0}},methods:{getCheckboxProps:function(t){return{props:{disabled:this.disabled}}},init:function(){var t=this;this.productTypeId&&(this.loading=!0,this.whetherProductKey&&(this.instructRows=[],this.selectedRowKeys=[]),Object(o["H"])({productTypeId:this.productTypeId,productKey:this.whetherProductKey?"":this.formData.productKey}).then((function(e){0===e.code?(t.instructData=e.data||[],t.mustList=t.instructData.filter((function(t){return 1===t.required})),t.disabled&&(t.instructData=t.instructData.filter((function(e){return t.selectedRowKeys.some((function(t){return t===e.id}))})))):(t.toast(e),t.instructData=[],t.mustList=[]),t.loading=!1})))},onSelectChange:function(t,e){this.instructRows=e,this.selectedRowKeys=this.instructRows.map((function(t){return t.id})),this.$emit("onChangeInstruction",this.instructRows)}}},s=n,l=a("2877"),d=Object(l["a"])(s,i,r,!1,null,"65e8c198",null);e["default"]=d.exports},"4e98":function(t,e,a){"use strict";a.r(e);a("b0c0");var i=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:t.modalTitle,width:640,visible:t.visible,"confirm-loading":t.confirmLoading},on:{cancel:t.handleCancel},scopedSlots:t._u([{key:"footer",fn:function(){return[e("a-button",{key:"back",on:{click:t.handleCancel}},[t._v("取消")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-button",{key:"submit",attrs:{type:"primary",loading:t.confirmLoading},on:{click:t.handleOk}},[t._v(" 确定 ")])]},proxy:!0}])},[e("a-spin",{attrs:{spinning:t.confirmLoading}},[1==t.status?e("p",[t._v(" 发布后，以下信息将不能修改，请确保以下信息正确无误！"),e("br"),t._v(" 发布成功后，本产品类型将在开放平台展示 ")]):t._e(),2==t.status?e("p",[t._v(" 停用后，本产品类型将不在开放平台展示，开放平台原有的该类型产品，不受影响 ")]):t._e(),e("a-form-model",{attrs:{"label-col":{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}}},[e("a-form-model-item",{attrs:{label:"产品名称"}},[t._v(t._s(t.info.name))]),e("a-form-model-item",{attrs:{label:"产品分类"}},[t._v(" "+t._s(t.info.productTypeName)+" ")]),e("a-form-model-item",{attrs:{label:"设备性质"}},[e("div",[t._v(t._s(t.$DictName("device_nature",t.info.attributeType)))])]),e("a-form-model-item",{attrs:{label:"通讯协议"}},[t._v(" "+t._s(t.$DictName("network_type",t.info.networkType))+" ")])],1)],1)],1)},r=[],o=(a("d3b7"),a("c4c8")),n={props:{productTypeList:{type:Array,default:function(){return[]}}},data:function(){return{info:{},status:null,modalTitle:null,visible:!1,confirmLoading:!1}},methods:{init:function(t,e,a){this.modalTitle=t,this.info=e,this.status=a,this.visible=!0,this.getProductTypeName(this.productTypeList)},getProductTypeName:function(t){var e=this;return t.some((function(t){return t.id===e.info.productTypeId?(e.info.productTypeName=t.name,!0):t.children&&t.children.length?e.getProductTypeName(t.children):void 0}))},handleOk:function(){var t=this;this.confirmLoading=!0,Object(o["N"])({id:this.info.id,status:this.status}).then((function(e){t.toast(e),0==e.code&&(t.$emit("ok"),t.visible=!1)})).finally((function(){t.confirmLoading=!1}))},handleCancel:function(){this.visible=!1}}},s=n,l=a("2877"),d=Object(l["a"])(s,i,r,!1,null,"48df1684",null);e["default"]=d.exports},"8c8c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-module"},[e("div",[t._v(" "+t._s("已选择模组(".concat(t.moduleRows.length,"个)"))+" ")]),e("div",{staticStyle:{padding:"10px 0"}}),e("a-table",{attrs:{size:"small",rowKey:"id",loading:t.loading,"data-source":t.moduleData,columns:t.moduleColumns,"row-selection":t.disabled?{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange,getCheckboxProps:function(){return{props:{disabled:!0}}}}:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange},pagination:t.pagination},on:{change:t.onChangePagination},scopedSlots:t._u([{key:"firmwareType",fn:function(a,i){return[e("div",[t._v(t._s(t.$DictName("firmware_type",i.firmwareType)))])]}},{key:"defaultVersion",fn:function(a,i){return[e("div",[t._v(t._s(i.defaultVersion?"v".concat(i.defaultVersion):""))])]}}])})],1)},r=[],o=a("2909"),n=a("5530"),s=(a("99af"),a("d81d"),a("d3b7"),a("25f0"),a("4de4"),a("caad"),a("2532"),a("c4c8")),l={props:{formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1}},data:function(){return{pagination:{showSizeChanger:!0,current:1,pageSize:10,total:0,showTotal:function(t,e){return"总数:".concat(t," 当前:").concat(e[0],"-").concat(e[1])}},queryParam:{page:1,limit:10,query:{status:1}},loading:!1,moduleData:[],moduleColumns:[{dataIndex:"moduleName",title:"模组名称",ellipsis:!0},{dataIndex:"firmwareName",title:"关联固件名称"},{dataIndex:"firmwareType",title:"固件类型",scopedSlots:{customRender:"firmwareType"},ellipsis:!0},{dataIndex:"firmwareKey",title:"固件key"},{dataIndex:"versions",title:"关联固件版本号"},{dataIndex:"defaultVersion",title:"默认版本号",scopedSlots:{customRender:"defaultVersion"},ellipsis:!0}],selectedRowKeys:[],moduleRows:[]}},created:function(){},watch:{formData:{handler:function(t,e){t&&t.id&&(this.moduleRows=t.moduleIds.map((function(t){return{id:t}})),this.selectedRowKeys=t.moduleIds),this.init()},immediate:!0}},methods:{onChangePagination:function(t){this.queryParam.limit=t.pageSize,this.queryParam.page=t.current,this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.init()},init:function(){var t=this;this.loading=!0,Object(s["s"])(this.queryParam).then((function(e){var a;0===e.code?(t.moduleData=null===e||void 0===e||null===(a=e.data)||void 0===a||null===(a=a.list)||void 0===a?void 0:a.map((function(t){var e;return Object(n["a"])(Object(n["a"])({},t),{},{versions:(null===(e=t.versionList)||void 0===e||null===(e=e.map((function(t){return"v".concat(t.version)})))||void 0===e?void 0:e.toString())||""})})),t.pagination.total=e.data.total):t.toast(e);t.loading=!1}))},onSelectChange:function(t,e,a){this.moduleRows=[].concat(Object(o["a"])(this.moduleRows),Object(o["a"])(e));var i=e.map((function(t){return t.id})),r=this.moduleData.filter((function(t){return!i.includes(t.id)})),n=r.map((function(t){return t.id}));this.moduleRows=this.moduleRows.filter((function(t){return!n.includes(t.id)})),this.moduleRows=this.removeDuplicate(this.moduleRows),this.selectedRowKeys=this.moduleRows.map((function(t){return t.id}));var s=this.moduleRows.map((function(t){return t.id}));this.$emit("onChangeModule",s)},removeDuplicate:function(t){var e={};return t=t.reduce((function(t,a){return!e[a.id]&&(e[a.id]=t.push(a)),t}),[]),t}}},d=l,c=a("2877"),u=Object(c["a"])(d,i,r,!1,null,"52babb0d",null);e["default"]=u.exports},"9e77":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-product-details"},[e("a-card",{attrs:{bordered:!1}},[e("a-page-header",{attrs:{title:t.title},on:{back:t.goBack}},[e("a-spin",{attrs:{spinning:t.loading}},[e("a-card",{attrs:{title:"基本信息",bordered:!1}},[e("basic-information",{ref:"basicInformation",attrs:{disabled:t.disabled,productTypeList:t.productTypeList,formData:t.form},on:{onChangeProductTypeId:function(e){t.productTypeId=e,t.instructList=[],t.whetherProductKey=!0}}})],1),e("a-card",{attrs:{title:"控制指令",bordered:!1}},["edit"!==t.detailsType||t.disabled?t._e():e("a-button",{attrs:{slot:"extra",type:"primary"},on:{click:t.resetProductThingModels},slot:"extra"},[t._v("重置物模型")]),e("control-instruction",{ref:"controlInstruction",attrs:{productTypeId:t.productTypeId,disabled:t.disabled,formData:t.form,whetherProductKey:t.whetherProductKey},on:{onChangeInstruction:function(e){t.instructList=e}}})],1),e("a-card",{attrs:{title:"场景条件",bordered:!1}},[e("scene-condition",{ref:"sceneCondition",attrs:{instructList:t.instructList,disabled:t.disabled,formData:t.form}})],1),e("a-card",{attrs:{title:"控制面板",bordered:!1}},[e("control-panel",{ref:"controlPanel",attrs:{productTypeId:t.productTypeId,productTypeList:t.productTypeList,disabled:t.disabled,formData:t.form}})],1),e("a-card",{attrs:{title:"模组选择",bordered:!1}},[e("module-component",{ref:"moduleComponent",attrs:{formData:t.form,disabled:t.disabled},on:{onChangeModule:function(e){t.moduleIds=e}}})],1),e("a-card",{attrs:{title:"配网方式",bordered:!1}},[e("network-guide",{ref:"networkGuide",attrs:{formData:t.form,disabled:t.disabled}})],1),e("a-card",{attrs:{bordered:!1}},[e("div",{staticClass:"footer-button"},[e("a-space",["add"===t.detailsType?[e("a-button",{attrs:{type:"primary"},on:{click:t.saveProduct}},[t._v(" 保存 ")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-button",{attrs:{type:"primary"},on:{click:t.savePublishProduct}},[t._v(" 保存并发布 ")])]:t._e(),"edit"===t.detailsType?[e("a-button",{attrs:{type:"primary"},on:{click:t.editProduct}},[t._v(" 更新 ")]),e("a-divider",{attrs:{type:"vertical"}}),1!==t.form.status?e("a-button",{attrs:{type:"primary"},on:{click:t.editPublishProduct}},[t._v(" 更新发布 ")]):t._e()]:t._e(),"details"===t.detailsType?[e("a-button",{attrs:{type:"primary",disabled:1===t.form.status},on:{click:t.switchToEdit}},[t._v(" 修改 ")]),1===t.form.status?e("a-divider",{attrs:{type:"vertical"}}):t._e(),1===t.form.status?e("a-button",{attrs:{type:"primary"},on:{click:t.setProductStatus}},[t._v(" 停用 ")]):t._e(),0===t.form.status||2===t.form.status?e("a-divider",{attrs:{type:"vertical"}}):t._e(),0===t.form.status||2===t.form.status?e("a-button",{attrs:{type:"primary"},on:{click:t.setProductStatus}},[t._v(" 发布 ")]):t._e()]:t._e(),e("a-divider",{attrs:{type:"vertical"}}),e("a-button",{on:{click:function(e){return t.$multiTab.closeCurrentPage()}}},[t._v(" 取消 ")])],2)],1)])],1)],1)],1),e("set-status-modal",{ref:"setStatusModal",attrs:{productTypeList:t.productTypeList},on:{ok:t.init}})],1)},r=[],o=a("5530"),n=a("c7eb"),s=a("1da1"),l=(a("b0c0"),a("4de4"),a("d3b7"),a("d81d"),a("c4c8")),d=a("2bf6"),c=a("4788"),u=a("c490"),p=a("b099"),m=a("8c8c"),f=a("15ff"),h=a("33ea"),b=a("4e98"),g=(a("3e8f"),{name:"ProductDetails",components:{"network-guide":d["default"],"basic-information":u["default"],"control-instruction":c["default"],"control-panel":p["default"],"module-component":m["default"],"firmware-component":f["default"],"scene-condition":h["default"],"set-status-modal":b["default"]},data:function(){return{form:{},current:0,productId:"",detailsType:"",productTypeId:"",disabled:!1,title:"",moduleIds:[],instructList:[],submitForm:{},loading:!1,productTypeList:[],whetherProductKey:!1}},created:function(){this.setFormStaus(this.$route.query.id,this.$route.query.type),this.init()},beforeRouteLeave:function(t,e,a){this.$store.commit("addRouterKeepAlive",e.name),this.$nextTick((function(){a()}))},methods:{setFormStaus:function(t,e){this.productId=t,this.detailsType=e,this.disabled=!1,"details"===this.detailsType?(this.disabled=!0,this.title="产品类型详情"):"add"===this.detailsType?this.title="添加产品类型":"edit"===this.detailsType&&(this.title="编辑产品类型"),this.$route.meta.title=this.title},init:function(){var t=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["u"])({});case 2:if(a=e.sent,0===a.code&&(t.productTypeList=a.data.list.filter((function(t){return t.children&&t.children.length}))),t.productId){e.next=6;break}return e.abrupt("return");case 6:t.getProductInfo();case 7:case"end":return e.stop()}}),e)})))()},getProductInfo:function(){var t=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,Object(l["G"])({id:t.productId});case 3:a=e.sent,0===a.code&&(a.data.thingModels=(a.data.thingModels||[]).filter((function(t){return t.valid})),t.form=a.data,t.productTypeId=a.data.productTypeId,t.instructList=t.form.thingModels,t.moduleIds=t.form.moduleIds,1===t.form.status&&(t.disabled=!0),t.loading=!1);case 5:case"end":return e.stop()}}),e)})))()},saveProduct:function(){var t=this;this.setData((function(){t.loading=!0,t.submitForm.isPublish=0,Object(l["f"])(t.submitForm).then((function(e){t.toast(e),0===e.code&&t.$multiTab.closeCurrentPage(),t.loading=!1}))}))},savePublishProduct:function(){var t=this;this.setData((function(){t.loading=!0,t.submitForm.isPublish=1,Object(l["f"])(t.submitForm).then((function(e){t.toast(e),0===e.code&&t.$multiTab.closeCurrentPage(),t.loading=!1}))}))},editProduct:function(){var t=this;this.setData((function(){t.loading=!0,t.submitForm.id=t.productId,Object(l["p"])(t.submitForm).then((function(e){t.toast(e),0===e.code&&("details"===t.$route.query.type?t.setFormStaus(t.$route.query.id,t.$route.query.type):t.$multiTab.closeCurrentPage()),t.loading=!1}))}))},editPublishProduct:function(){var t=this;this.setData((function(){t.loading=!0,t.submitForm.isPublish=1,t.submitForm.id=t.productId,Object(l["p"])(t.submitForm).then((function(e){t.toast(e),0===e.code&&("details"===t.$route.query.type?t.setFormStaus(t.$route.query.id,t.$route.query.type):t.$multiTab.closeCurrentPage()),t.loading=!1}))}))},setData:function(t){var e=this,a=this.$refs["controlInstruction"].instructRows;if(0!==a.length)if(this.$refs["controlInstruction"].disabledForm)this.$message.warning("有必选的控制指令未选择");else{var i=this.$refs["controlPanel"].controlPanelRows.map((function(t){return t.id}));if(0!==i.length){var r=this.$refs["moduleComponent"].moduleRows.map((function(t){return t.id}));if(0!==r.length){var n=this.$refs["moduleComponent"].moduleRows.map((function(t){return t.firmwareId})),s=this.$refs["networkGuide"].networkGuides.filter((function(t){return t.bl}));0!==s.length?this.$refs["basicInformation"].verifyForm((function(){var l=e.$refs["basicInformation"].form;e.submitForm=Object(o["a"])(Object(o["a"])(Object(o["a"])({},e.form),l),{},{moduleIds:r,firmwareIds:n,controlPanelIds:i,thingModels:a,networkGuides:s}),t()})):this.$message.warning("请选择配网方式")}else this.$message.warning("请选择模组")}else this.$message.warning("请选择控制面板")}else this.$message.warning("请选择控制指令")},setProductStatus:function(){var t=this,e="",a=null;0==this.form.status||2==this.form.status?this.setData((function(){a=1,e="确认发布吗?",t.$refs["setStatusModal"].init(e,t.form,a)})):(a=2,e="确认停用吗?",this.$refs["setStatusModal"].init(e,this.form,a))},switchToEdit:function(){this.setFormStaus(this.$route.query.id,"edit")},goBack:function(){this.$multiTab.closeCurrentPage()},resetProductThingModels:function(){var t=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["J"])({productId:t.productId});case 2:if(a=e.sent,0===a.code){e.next=5;break}return e.abrupt("return");case 5:t.toast(a),t.$refs.controlInstruction.init(),t.getProductInfo();case 8:case"end":return e.stop()}}),e)})))()}}}),y=g,w=(a("191a"),a("2877")),v=Object(w["a"])(y,i,r,!1,null,"e5776bf2",null);e["default"]=v.exports},"9ed7":function(t,e,a){},b006:function(t,e,a){"use strict";a("9ed7")},c490:function(t,e,a){"use strict";a.r(e);a("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"aithings-basic-information"},[e("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.disabled?{}:t.rules}},[e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"名称(中文)",prop:"name"}},[t.disabled?e("div",[t._v(t._s(t.form.name))]):e("a-input",{attrs:{placeholder:"请输入名称(中文)"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"名称(英文)",prop:"nameEn"}},[t.disabled?e("div",[t._v(t._s(t.form.nameEn))]):e("a-input",{attrs:{placeholder:"请输入名称(英文)"},model:{value:t.form.nameEn,callback:function(e){t.$set(t.form,"nameEn",e)},expression:"form.nameEn"}})],1)],1)],1),t.disabled?e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"产品类型KEY",prop:"productKey"}},[e("div",[t._v(t._s(t.form.productKey))])])],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"状态",prop:"status"}},[e("div",[t._v(t._s(t.$DictName("product_release",t.form.status)))])])],1)],1):t._e(),e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"产品分类",prop:"productTypeIdPath"}},[t.disabled?e("div",[t._v(t._s(t.form.productTypeName))]):e("a-cascader",{attrs:{disabled:"edit"===t.$route.query.type,allowClear:!1,options:t.productTypeList,"display-render":t.displayRender,fieldNames:t.replaceFields,"expand-trigger":"hover",placeholder:"请选择产品分类"},on:{change:t.onChangeProductTypeId},model:{value:t.form.productTypeIdPath,callback:function(e){t.$set(t.form,"productTypeIdPath",e)},expression:"form.productTypeIdPath"}})],1)],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"通讯协议",prop:"networkType"}},[t.disabled?e("div",[t._v(" "+t._s(t.$DictName("network_type",t.form.networkType))+" ")]):e("a-select",{attrs:{placeholder:"请选择通讯协议"},model:{value:t.form.networkType,callback:function(e){t.$set(t.form,"networkType",e)},expression:"form.networkType"}},t._l(t.$DictList("network_type"),(function(a){return e("a-select-option",{key:a.key,attrs:{value:a.key}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1)],1),e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"WIFI标识",prop:"wifiFlag"}},[t.disabled?e("div",[t._v(t._s(t.form.wifiFlag))]):e("a-input",{attrs:{placeholder:"请输入WIFI标识"},model:{value:t.form.wifiFlag,callback:function(e){t.$set(t.form,"wifiFlag",e)},expression:"form.wifiFlag"}})],1)],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"设备性质",prop:"attributeType"}},[t.disabled?e("div",[t._v(" "+t._s(t.$DictName("device_nature",t.form.attributeType))+" ")]):e("a-select",{attrs:{placeholder:"请选择设备性质"},model:{value:t.form.attributeType,callback:function(e){t.$set(t.form,"attributeType",e)},expression:"form.attributeType"}},t._l(t.$DictList("device_nature"),(function(a){return e("a-select-option",{key:a.key,attrs:{value:a.key}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1)],1),e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"虚拟测试",prop:"isVirtualTest"}},[t.disabled?e("div",[t._v(" "+t._s(t.$DictName("Is_virtual_test",t.form.isVirtualTest))+" ")]):e("a-radio-group",{model:{value:t.form.isVirtualTest,callback:function(e){t.$set(t.form,"isVirtualTest",e)},expression:"form.isVirtualTest"}},t._l(t.$DictList("Is_virtual_test"),(function(a){return e("a-radio",{key:a.key,attrs:{value:a.key}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"功耗",prop:"powerConsumeType"}},[t.disabled?e("div",[t._v(" "+t._s(t.$DictName("power_consume_type",t.form.powerConsumeType))+" ")]):e("a-radio-group",{model:{value:t.form.powerConsumeType,callback:function(e){t.$set(t.form,"powerConsumeType",e)},expression:"form.powerConsumeType"}},t._l(t.$DictList("power_consume_type"),(function(a){return e("a-radio",{key:a.key,attrs:{value:a.key}},[t._v(" "+t._s(a.label)+" ")])})),1)],1)],1)],1),e("a-row",[e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"图标",prop:"imageUrl"}},[e("a-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:t.form.imageUrl,callback:function(e){t.$set(t.form,"imageUrl",e)},expression:"form.imageUrl"}}),e("upload-img",{attrs:{imgDir:"product",imgSizeMode:2,imgRequest:!0,propsImgSrc:t.form.imageUrl,disabled:t.disabled,imgHint:"建议80*80像素,比例必须1:1,png格式最佳,大小不超过1M"},on:{ok:t.handleUploadImg}})],1)],1),e("a-col",t._b({},"a-col",t.colFlex,!1),[e("a-form-model-item",{attrs:{"label-col":t.two.labelCol,"wrapper-col":t.two.wrapperCol,label:"备注"}},[t.disabled?e("div",[t._v(t._s(t.form.remark))]):e("input-textarea",{attrs:{maxLength:500,placeholder:"请输入备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1)],1)],1)],1)},r=[],o=a("c7eb"),n=a("1da1"),s=a("5530"),l=(a("d3b7"),a("61f7")),d={props:{productTypeList:{type:Array,default:function(){return[]}},formData:{type:Object,default:{}},disabled:{type:Boolean,default:!1}},data:function(){return{two:{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},colFlex:{xl:12,lg:24,md:24,sm:24},form:{productTypeId:"",productTypeIdPath:[],name:"",nameEn:"",imageUrl:"",wifiFlag:"",isVirtualTest:1,powerConsumeType:1,desc:""},rules:{productTypeIdPath:Object(l["d"])("请选择产品分类","array"),name:Object(l["r"])("请填写中文名"),nameEn:Object(l["i"])("请填写英文名"),wifiFlag:Object(l["p"])("请填写wifi标识"),networkType:Object(l["d"])("请选择通讯协议","number"),attributeType:Object(l["d"])("请选择设备性质","number"),isVirtualTest:Object(l["d"])("请选择是否支持虚拟测试","number"),powerConsumeType:Object(l["d"])("请选择功耗","number"),imageUrl:Object(l["d"])("请上传图片")},replaceFields:{children:"children",label:"name",key:"id",value:"id"}}},watch:{formData:function(t,e){t&&t.id&&(this.form=Object(s["a"])({},t),this.getProductTypeName(this.productTypeList))}},methods:{getProductTypeName:function(t){var e=this;return t.some((function(t){return t.id===e.formData.productTypeId?(e.form.productTypeName=t.name,!0):t.children&&t.children.length?e.getProductTypeName(t.children):void 0}))},handleUploadImg:function(t){var e=this;return Object(n["a"])(Object(o["a"])().mark((function a(){return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.$set(e.form,"imageUrl",t.fullPath),e.$refs["ruleForm"].clearValidate(["imageUrl"]);case 2:case"end":return a.stop()}}),a)})))()},onChangeProductTypeId:function(t){this.form.productTypeId=t[t.length-1],this.$emit("onChangeProductTypeId",this.form.productTypeId)},displayRender:function(t){var e=t.labels;return e[e.length-1]},verifyForm:function(t){var e=this;this.$refs["ruleForm"].validate((function(a){a?t():e.$message.warning("基础信息填写不完整")}))}}},c=d,u=a("2877"),p=Object(u["a"])(c,i,r,!1,null,"c1ff9a46",null);e["default"]=p.exports}}]);