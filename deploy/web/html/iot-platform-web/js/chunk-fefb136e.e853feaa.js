(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fefb136e","chunk-2d20f8f8"],{"738c":function(e,t,i){"use strict";i.r(t);i("b0c0"),i("b680"),i("a9e3");var a=function(){var e=this,t=e._self._c;return t("a-row",{attrs:{gutter:16}},[t("a-card",{attrs:{bordered:!1}},[t("a-page-header",{attrs:{title:e.title},on:{back:function(t){return e.$multiTab.closeCurrentPage()}}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-card",{attrs:{title:e.$t("firmware.baseMsg"),bordered:!1}},[t("a-form-model",{ref:"ruleForm",attrs:{model:e.form,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,rules:e.formDisabled?{}:e.rules}},[t("a-form-model-item",{attrs:{label:e.$t("firmware.firmwareName"),prop:"name"}},[e.formDisabled?t("div",[e._v(e._s(e.form.name))]):t("a-input",{attrs:{placeholder:"请输入固件名称(中文)"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("a-form-model-item",{attrs:{label:"固件名称(英文)",prop:"nameEn"}},[e.formDisabled?t("div",[e._v(e._s(e.form.nameEn))]):t("a-input",{attrs:{placeholder:"请输入固件名称(英文)"},model:{value:e.form.nameEn,callback:function(t){e.$set(e.form,"nameEn",t)},expression:"form.nameEn"}})],1),e.formDisabled?t("a-form-model-item",{attrs:{label:"固件key"}},[t("div",[e._v(e._s(e.form.id))])]):e._e(),t("a-form-model-item",{attrs:{label:e.$t("firmware.flag"),prop:"flag"}},[e.formDisabled?t("div",[e._v(e._s(e.form.flag))]):t("a-input",{attrs:{placeholder:"请输入固件标识"},model:{value:e.form.flag,callback:function(t){e.$set(e.form,"flag",t)},expression:"form.flag"}})],1),t("a-form-model-item",{attrs:{label:e.$t("firmware.type"),prop:"type"}},[e.formDisabled?t("div",[e._v(" "+e._s(e.$DictName("firmware_type",e.form.type))+" ")]):t("a-select",{attrs:{placeholder:"请选择固件类型",disabled:"add"!==e.type},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.$DictList("firmware_type"),(function(i){return t("a-select-option",{key:i.key,attrs:{value:i.key}},[e._v(e._s(i.label))])})),1)],1),t("a-form-model-item",{attrs:{label:e.$t("firmware.flashSize"),prop:"flashSize"}},[e.formDisabled?t("div",[e._v(" "+e._s(e.$DictName("flash_size",e.form.flashSize))+" ")]):t("a-select",{attrs:{placeholder:"请选择Flash大小"},model:{value:e.form.flashSize,callback:function(t){e.$set(e.form,"flashSize",t)},expression:"form.flashSize"}},e._l(e.$DictList("flash_size"),(function(i){return t("a-select-option",{key:i.key,attrs:{value:i.key}},[e._v(" "+e._s(i.label)+" ")])})),1)],1),t("a-form-model-item",{attrs:{label:e.$t("firmware.upgradeOvertime"),prop:"upgradeOvertime"}},[e.formDisabled?t("span",[e._v(e._s(e.form.upgradeOvertime))]):t("a-input-number",{staticStyle:{width:"70%"},attrs:{min:1,max:300,precision:0,placeholder:"请输入升级超时时间,1~300"},model:{value:e.form.upgradeOvertime,callback:function(t){e.$set(e.form,"upgradeOvertime",t)},expression:"form.upgradeOvertime"}}),t("span",{staticClass:"ant-form-text"},[e._v(e._s(e.$t("firmware.second")))]),t("br"),e.formDisabled?e._e():t("span",{staticStyle:{color:"#ccc"}},[e._v("最多300秒")])],1),t("a-form-model-item",{attrs:{label:e.$t("public.remark")}},[e.formDisabled?t("div",[e._v(e._s(e.form.remark))]):t("input-textarea",{attrs:{placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),"add"===e.type?t("a-form-model-item",{attrs:{label:e.$t("firmware.version"),prop:"version"}},[t("a-input",{attrs:{placeholder:"例如：1.0.1"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}}),t("div",{staticStyle:{color:"#ccc"}},[e._v("版本号格式：xx.xx.xx")])],1):e._e(),"add"===e.type?t("a-form-model-item",{attrs:{label:"版本描述",prop:"desc"}},[t("input-textarea",{attrs:{placeholder:"请输入版本描述"},on:{input:function(t){return e.$refs["ruleForm"].clearValidate(["desc"])}},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1):e._e(),"add"===e.type?t("a-form-model-item",{attrs:{label:"资源包",prop:"zipFileName"}},[t("a-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:e.form.zipFileName,callback:function(t){e.$set(e.form,"zipFileName",t)},expression:"form.zipFileName"}}),t("upload-file",{attrs:{fileDir:"firmwareDoc",fileIcon:"folder",fileHint:"zip格式文件",fileType:["application/x-zip-compressed","application/octet-stream","application/zip","application/x-zip"],propsAccept:[".zip"],propsFileName:e.form.zipFileName,propsFileSrc:e.form.zipFilePath,fileSize:10,isRequest:!0},on:{ok:function(t){return e.onChangeFile(t,"zip")}}})],1):e._e(),"add"===e.type?t("a-form-model-item",{attrs:{label:"OTA包",prop:"fileName"}},[t("a-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:e.form.fileName,callback:function(t){e.$set(e.form,"fileName",t)},expression:"form.fileName"}}),t("upload-file",{attrs:{fileDir:"firmwareDoc",fileIcon:"folder",fileHint:"固件为bin格式,且不超过10M",fileType:["application/x-zip-compressed","application/octet-stream","application/zip","application/x-zip"],propsAccept:[".bin"],propsFileName:e.form.fileName,propsFileSrc:e.form.filePath,fileSize:10,isRequest:!0},on:{ok:function(t){return e.onChangeFile(t,"bin")}}})],1):e._e(),"add"===e.type?t("a-form-model-item",{attrs:{label:"关键版本",prop:"isMust"}},[t("a-radio-group",{attrs:{options:e.$DictList("yes_no")},model:{value:e.form.isMust,callback:function(t){e.$set(e.form,"isMust",t)},expression:"form.isMust"}})],1):e._e(),t("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:3}}},[e.formDisabled?t("a-button",{attrs:{type:"primary"},on:{click:e.editForm}},[e._v(" "+e._s(e.$t("public.update"))+" ")]):e._e(),e.formDisabled?t("a-divider",{attrs:{type:"vertical"}}):e._e(),e.formDisabled||"edit"!==e.type&&"details"!==e.type?e._e():t("a-button",{attrs:{type:"primary"},on:{click:e.sumitEdit}},[e._v(" "+e._s(e.$t("public.ok"))+" ")]),e.formDisabled||"edit"!==e.type&&"details"!==e.type?e._e():t("a-divider",{attrs:{type:"vertical"}}),e.formDisabled||"add"!==e.type?e._e():t("a-button",{attrs:{type:"primary"},on:{click:e.sumitAdd}},[e._v(" "+e._s(e.$t("public.ok"))+" ")]),e.formDisabled||"add"!==e.type?e._e():t("a-divider",{attrs:{type:"vertical"}}),"edit"!==e.type&&"details"!==e.type||1!=e.form.status?e._e():t("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.setFirmwareStatus(e.form)}}},[e._v(" 停用 ")]),"edit"!==e.type&&"details"!==e.type||1!=e.form.status?e._e():t("a-divider",{attrs:{type:"vertical"}}),"edit"!==e.type&&"details"!==e.type||2!=e.form.status?e._e():t("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.setFirmwareStatus(e.form)}}},[e._v(" 启用 ")]),"edit"!==e.type&&"details"!==e.type||2!=e.form.status?e._e():t("a-divider",{attrs:{type:"vertical"}}),t("a-button",{on:{click:function(t){return e.$multiTab.closeCurrentPage()}}},[e._v(" "+e._s(e.$t("public.back"))+" ")])],1)],1)],1)],1),"edit"==e.type||"details"==e.type?t("a-card",{attrs:{title:e.$t("firmware.versionMsg"),bordered:!1}},[t("div",{staticClass:"table-operator"},[t("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){return e.handleAdd()}}},[e._v(" 添加版本 ")])],1),t("a-table",{attrs:{size:"small",rowKey:"id","data-source":e.dataSource,columns:e.columns,loading:e.loading,pagination:e.pagination},on:{change:e.onChangePagination},scopedSlots:e._u([{key:"version",fn:function(i,a){return[t("a-button",{attrs:{size:"small",type:"link"},on:{click:function(t){return e.showInfo(a)}}},[e._v(" "+e._s(a.version)+" ")])]}},{key:"createdAt",fn:function(i,a){return[t("span",[e._v(e._s(e._f("momentFilter")(a.createdAt)))])]}},{key:"fileSize",fn:function(i,a){return[t("span",[e._v(e._s(Number(a.fileSize/1024).toFixed(2)+"kb"))])]}},{key:"status",fn:function(i,a){return[t("span",[e._v(e._s(e.$DictName("version_status",a.status)))])]}},{key:"action",fn:function(i){return[t("a-button",{attrs:{disabled:1==i.status,type:"link",size:"small",icon:"edit"},on:{click:function(t){return e.handleEdit(i)}}},[e._v(" "+e._s(e.$t("public.edit"))+" ")]),1==i.status?t("a-divider",{attrs:{type:"vertical"}}):e._e(),1==i.status?t("a-button",{attrs:{type:"link",size:"small",icon:"setting"},on:{click:function(t){return e.handleSet(i)}}},[e._v(" 下架 ")]):e._e(),2==i.status?t("a-divider",{attrs:{type:"vertical"}}):e._e(),2==i.status?t("a-button",{attrs:{type:"link",size:"small",icon:"setting"},on:{click:function(t){return e.handleSet(i)}}},[e._v(" 上架 ")]):e._e()]}}],null,!1,3014352065)})],1):e._e()],1)],1),t("edit-version",{ref:"versionForm",on:{ok:e.getFirmwareList}}),t("version-info",{ref:"versionInfo"}),t("putaway-modal",{ref:"putawayModal",on:{ok:e.getFirmwareList}})],1)},r=[],o=i("c7eb"),l=i("1da1"),s=(i("99af"),i("c4c8")),n=i("2abe"),m=i("b3c4"),c=i("d431"),f=i("61f7"),p={name:"FirmwareDetails",components:{"edit-version":n["default"],"version-info":m["default"],"putaway-modal":c["default"]},data:function(){return{title:"",id:"",type:"",form:{name:"",nameEn:"",flag:"",type:void 0,flashSize:void 0,upgradeOvertime:"",remark:"",version:"",filePath:"",fileSize:"",fileKey:"",fileName:""},confirmLoading:!1,formDisabled:!0,labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:8}},rules:{name:Object(f["r"])(this.$t("firmware.inputName")),nameEn:Object(f["i"])(this.$t("firmware.inputName")),flag:Object(f["j"])(this.$t("firmware.inputFlag")),type:Object(f["d"])(this.$t("firmware.inputType"),"number"),flashSize:Object(f["d"])(this.$t("firmware.inputFlashSize"),"number"),upgradeOvertime:Object(f["d"])(this.$t("firmware.inputUpgradeTime"),"number"),version:Object(f["o"])(this.$t("firmware.inputVersionName")),desc:Object(f["d"])("请输入版本描述"),zipFileName:Object(f["d"])("请上传资源包"),fileName:Object(f["d"])("请上传OTA包"),isMust:Object(f["d"])("请选择是否关键版本","number")},pagination:{showSizeChanger:!0,current:1,pageSize:10,total:0,showTotal:function(e,t){return"总数:".concat(e," 当前:").concat(t[0],"-").concat(t[1])}},queryParam:{page:1,limit:10,query:{firmwareId:""}},loading:!1,dataSource:[],columns:[{dataIndex:"version",title:this.$t("firmware.version"),scopedSlots:{customRender:"version"}},{dataIndex:"desc",title:this.$t("firmware.versionDetails"),ellipsis:!0},{dataIndex:"fileSize",title:this.$t("firmware.size"),scopedSlots:{customRender:"fileSize"}},{dataIndex:"createdAt",title:this.$t("firmware.updateTime"),scopedSlots:{customRender:"createdAt"}},{dataIndex:"status",title:this.$t("public.status"),scopedSlots:{customRender:"status"}},{title:this.$t("public.action"),key:"action",align:"center",width:"180px",scopedSlots:{customRender:"action"}}]}},mounted:function(){this.id=this.$route.query.id,this.queryParam.query.firmwareId=this.id,this.type=this.$route.query.type,this.formDisabled=!1,"add"===this.type?this.title="添加固件":"details"===this.type?(this.title="固件详情",this.formDisabled=!0,this.getFirmwareDetails(),this.getFirmwareList()):"edit"===this.type&&(this.title="编辑固件",this.getFirmwareDetails(),this.getFirmwareList()),this.$route.meta.title=this.title},methods:{showInfo:function(e){this.$refs["versionInfo"].init(e)},getFirmwareDetails:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(s["q"])("".concat(e.id));case 2:if(i=t.sent,0===i.code){t.next=5;break}return t.abrupt("return");case 5:e.form=i.data;case 6:case"end":return t.stop()}}),t)})))()},getFirmwareList:function(){var e=this;return Object(l["a"])(Object(o["a"])().mark((function t(){var i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(s["E"])(e.queryParam);case 3:if(i=t.sent,e.loading=!1,0==i.code){t.next=7;break}return t.abrupt("return");case 7:e.dataSource=i.data.list,e.pagination.total=i.data.total;case 9:case"end":return t.stop()}}),t)})))()},handleSet:function(e){var t=this;2==e.status?this.$refs["putawayModal"].init(e,this.form):1==e.status&&this.$confirm({content:"是否确定下架!",onOk:function(){Object(s["P"])({id:e.id}).then((function(e){0==e.code?(t.getFirmwareList(),t.toast(e)):t.toast("本版本已与模组关联，请先解除关联关系")}))}})},onChangePagination:function(e){this.queryParam.limit=e.pageSize,this.queryParam.page=e.current,this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.getFirmwareList()},sumitEdit:function(){var e=this;this.$refs["ruleForm"].validate(function(){var t=Object(l["a"])(Object(o["a"])().mark((function t(i){var a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:return e.confirmLoading=!0,t.next=5,Object(s["n"])(e.form);case 5:a=t.sent,e.confirmLoading=!1,e.toast(a),"edit"!==e.type&&"add"!==e.type||0!==a.code?"details"===e.type&&0===a.code&&(e.formDisabled=!0,e.title="固件详情",e.$route.meta.title=e.title):e.$multiTab.closeCurrentPage();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleEdit:function(e){var t={newVersion:this.form.version,firmwareName:this.form.name,firmwareId:this.form.id,isMust:e.isMust,version:e.version,desc:e.desc,status:e.status,id:e.id,zipFileKey:e.zipFileKey,zipFileName:e.zipFileName,zipFilePath:e.zipFilePath,zipFileSize:e.zipFileSize,filePath:e.filePath,fileSize:e.fileSize,fileKey:e.fileKey,fileName:e.fileName};this.$refs["versionForm"].init("edit",t)},sumitAdd:function(){var e=this;this.$refs["ruleForm"].validate(function(){var t=Object(l["a"])(Object(o["a"])().mark((function t(i){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:e.confirmLoading=!0,Object(s["d"])(e.form).then((function(t){0==t.code&&e.$multiTab.closeCurrentPage(),e.confirmLoading=!1,e.toast(t)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},editForm:function(){this.formDisabled=!1,this.title="编辑固件",this.$route.meta.title=this.title},onChangeFile:function(e,t){"bin"===t?(this.$set(this.form,"filePath",e.fullPath),this.$set(this.form,"fileKey",e.key),this.$set(this.form,"fileSize",e.size),this.$set(this.form,"fileName",e.name),this.$refs["ruleForm"].clearValidate(["fileName"])):"zip"===t&&(this.$set(this.form,"zipFilePath",e.fullPath),this.$set(this.form,"zipFileKey",e.key),this.$set(this.form,"zipFileSize",e.size),this.$set(this.form,"zipFileName",e.name),this.$refs["ruleForm"].clearValidate(["zipFileName"]))},handleAdd:function(){var e={newVersion:this.form.version,firmwareName:this.form.name,firmwareId:this.form.id,isMust:this.form.isMust,status:2};this.$refs["versionForm"].init("add",e)},setFirmwareStatus:function(e){var t=this,i="",a=null;2==e.status?(a=1,i="是否启用固件"):(a=2,i="是否停用固件"),this.$UpdateStatus(this,i).then((function(i){var r={id:e.id,status:a};Object(s["M"])(r).then((function(e){0==e.code&&t.$multiTab.closeCurrentPage(),t.toast(e)}))}))}}},d=p,u=i("2877"),b=Object(u["a"])(d,a,r,!1,null,"21d7c4ae",null);t["default"]=b.exports},b3c4:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"查看版本信息",cancelText:"",width:640,visible:e.visible,"confirm-loading":e.confirmLoading},on:{cancel:function(t){e.visible=!1}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("a-button",{key:"submit",attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleOk}},[e._v(" 确定 ")])]},proxy:!0}])},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{attrs:{model:e.form}},[t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"版本号"}},[t("div",[e._v(e._s(e.form.version))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"版本描述"}},[t("div",[e._v(e._s(e.form.desc))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"资源包"}},[t("upload-file",{attrs:{fileIcon:"folder",disabled:"",download:"",propsFileName:e.form.zipFileName,propsFileSrc:e.form.zipFilePath}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"OTA包"}},[t("upload-file",{attrs:{fileIcon:"folder",disabled:"",download:"",propsFileName:e.form.fileName,propsFileSrc:e.form.filePath}})],1),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"关键版本"}},[e._v(" "+e._s(e.$DictName("yes_no",e.form.isMust))+" ")])],1)],1)],1)},r=[],o={data:function(){return{visible:!1,confirmLoading:!1,form:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{init:function(e){this.visible=!0,this.form=e},handleOk:function(){this.visible=!1}}},l=o,s=i("2877"),n=Object(s["a"])(l,a,r,!1,null,"33dbc968",null);t["default"]=n.exports},d431:function(e,t,i){"use strict";i.r(t);i("b0c0");var a=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:"查看版本信息",cancelText:"",width:640,visible:e.visible,"confirm-loading":e.confirmLoading},on:{cancel:function(t){e.visible=!1}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("a-button",{key:"submit",attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleOk}},[e._v(" 确定 ")])]},proxy:!0}])},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",[t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"固件名称"}},[t("div",[e._v(e._s(e.firmwareForm.name))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"固件类型"}},[t("div",[e._v(e._s(e.firmwareForm.typeName))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"固件KEY"}},[t("div",[e._v(e._s(e.firmwareForm.id))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"固件标识"}},[t("div",[e._v(e._s(e.firmwareForm.flag))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"Flash大小"}},[t("div",[e._v(e._s(e.$DictName("flash_size",e.firmwareForm.flashSize)))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"升级超时时间"}},[t("div",[e._v(e._s(e.firmwareForm.upgradeOvertime)+"S")])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"版本号"}},[t("div",[e._v(e._s(e.versionForm.version))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"版本描述"}},[t("div",[e._v(e._s(e.versionForm.desc))])]),t("a-form-model-item",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol,label:"固件包"}},[t("upload-file",{attrs:{fileIcon:"folder",disabled:"",download:"",propsFileName:e.versionForm.fileName,propsFileSrc:e.versionForm.filePath}})],1)],1)],1)],1)},r=[],o=(i("d3b7"),i("c4c8")),l={data:function(){return{visible:!1,confirmLoading:!1,versionForm:{},firmwareForm:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{init:function(e,t){this.visible=!0,this.versionForm=e,this.firmwareForm=t},handleOk:function(){var e=this;this.confirmLoading=!0,Object(o["O"])({id:this.versionForm.id}).then((function(t){e.toast(t)})).finally((function(){e.visible=!1,e.confirmLoading=!1,e.$emit("ok")}))}}},s=l,n=i("2877"),m=Object(n["a"])(s,a,r,!1,null,"4b69ca3c",null);t["default"]=m.exports}}]);