(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4adcc469"],{2975:function(t,e,a){"use strict";a.r(e);a("a9e3");var n=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:("add"==t.type?t.$t("public.add"):t.$t("public.Modify"))+t.$t("intelligentScene.details.button.task"),width:900,visible:t.visible,"confirm-loading":t.confirmLoading},on:{ok:t.handleOk,cancel:t.handleCancel}},[e("a-spin",{attrs:{spinning:t.confirmLoading}},[e("section",{staticClass:"content-wrap flex"},[t._l(t.colList,(function(a,n){return e("section",{key:n,staticClass:"col-wrap"},[e("section",{staticClass:"header flex y-axis-center x-space-between"},[e("span",{domProps:{textContent:t._s(a.title)}})]),e("section",{staticClass:"list"},["select"===a.type?t._l(t.lists[a.list],(function(s,c){return e("section",{key:c,class:["item flex y-axis-center x-space-between tap-pointer",{active:t.selectData[a.key]==s.value}],on:{click:function(e){return t.selectValue(a.key,t.lists[a.list],c)}}},[e("section",{class:[s.image?"flex y-axis-center":""]},[s.image?e("div",{staticClass:"image-wrap"},[e("img",{staticClass:"image",attrs:{src:s.image}})]):t._e(),e("p",{staticClass:"label",domProps:{textContent:t._s(s.label)}})]),2!==n?e("a-icon",{attrs:{type:"right"}}):t._e()],1)})):t._e(),"checkbox"===a.type?[e("a-checkbox-group",{on:{change:t.funcChange},model:{value:t.tasksCheck[t.selectData.productKey],callback:function(e){t.$set(t.tasksCheck,t.selectData.productKey,e)},expression:"tasksCheck[selectData.productKey]"}},t._l(t.lists[a.list],(function(s,c){return e("section",{key:c,class:["item func-item tap-pointer",{active:t.selectData[a.key]==s.value}],on:{click:function(e){return t.selectValue(a.key,t.lists[a.list],c)}}},[e("section",{staticClass:"flex y-axis-center"},[e("a-checkbox",{attrs:{value:s.value}}),e("section",{class:["func-content",s.image?"flex y-axis-center":""]},[s.image?e("div",{staticClass:"image-wrap"},[e("img",{staticClass:"image",attrs:{src:s.image}})]):t._e(),e("p",{staticClass:"label",domProps:{textContent:t._s(s.label)}}),s.identifier?e("p",{staticClass:"identifier"},[t._v(t._s("标识符：".concat(s.identifier)))]):t._e()]),2!==n?e("a-icon",{attrs:{type:"right"}}):t._e()],1)])})),0)]:t._e(),"textInput"===a.type?e("section",{staticClass:"input-wrap"},[e("a-input",{attrs:{maxLength:Number(t.numRange.length)},on:{change:t.inputChange},model:{value:t.selectData.funcValue,callback:function(e){t.$set(t.selectData,"funcValue",e)},expression:"selectData.funcValue"}})],1):t._e(),"numberInput"===a.type?e("section",{staticClass:"input-wrap"},[e("a-input-number",{attrs:{min:Number(t.numRange.min),max:Number(t.numRange.max),step:Number(t.numRange.step),precision:"INT"==t.numRange.dataType?0:3},on:{change:t.inputChange},model:{value:t.selectData.funcValue,callback:function(e){t.$set(t.selectData,"funcValue",e)},expression:"selectData.funcValue"}})],1):t._e()],2)])}))],2)])],1)},s=[],c=a("5530"),i=a("2909"),u=a("c7eb"),r=a("1da1"),l=(a("d3b7"),a("159b"),a("d81d"),a("4de4"),a("b0c0"),a("b64b"),a("c740"),a("a434"),a("c4c8")),o=(a("2ef0"),{name:"SetTask",components:{},props:{type:{type:String,default:""},visible:{type:Boolean,default:!1},data:{type:Object,default:function(){}},taskList:{type:Array,default:function(){return[]}}},data:function(){return{confirmLoading:!1,colList:[{title:this.$t("intelligentScene.details.select.product"),list:"productList",key:"productKey",type:"select"},{title:this.$t("intelligentScene.details.select.prop"),list:"taskFuncList",key:"funcKey",type:"checkbox"},{title:this.$t("intelligentScene.details.select.propValue"),list:"propsList",key:"funcValue",type:"select"}],lists:{productList:[],taskFuncList:[],propsList:[]},selectData:{productName:"",productKey:"",productId:"",funcKey:"",funcValue:"",funcCompare:2},numRange:{},tasksCheck:{},tasksData:{},originTaskList:[]}},watch:{visible:function(t){var e=this;return Object(r["a"])(Object(u["a"])().mark((function a(){return Object(u["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t){a.next=2;break}return a.abrupt("return");case 2:if(e.tasksCheck={},e.tasksData={},e.originTaskList=e.$deepClone(e.taskList),e.originTaskList.forEach((function(t){e.tasksData[t.productKey]=t.functions,e.$set(e.tasksCheck,t.productKey,t.functions.map((function(t){return Number(t.funcKey)})))})),"edit"!==e.type){a.next=13;break}return e.init(),a.next=10,e.getProductList();case 10:e.changeData(),a.next=16;break;case 13:return e.init(),a.next=16,e.getProductList();case 16:case"end":return a.stop()}}),a)})))()}},mounted:function(){},methods:{init:function(){this.lists={productList:[],taskFuncList:[],propsList:[]},this.selectData={productName:"",productKey:"",productId:"",funcKey:"",funcValue:"",funcCompare:2},this.numRange={}},changeData:function(){var t=this;return Object(r["a"])(Object(u["a"])().mark((function e(){var a,n,s;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.$deepClone(t.data),t.selectData.productId=n.productId,t.selectData.productKey=n.productKey,t.selectData.funcKey=Number(n.functions[0].funcKey),t.selectData.funcCompare=n.functions[0].funcCompare||2,t.selectData.funcValue=n.functions[0].funcValue,s=(null===(a=t.lists.productList)||void 0===a||null===(a=a.filter((function(t){return t.productKey===n.productKey})))||void 0===a?void 0:a.pop())||{},t.tasksData[n.productKey]=Object(i["a"])(n.functions),e.next=10,t.handleProductChange(s,!0);case 10:case"end":return e.stop()}}),e)})))()},selectValue:function(t,e,a){var n=this;this.selectData[t]=e[a].value;var s=this.selectData.productKey;if("productKey"===t)this.tasksCheck[s]||this.$set(this.tasksCheck,[s],[]),this.tasksData[s]||(this.tasksData[s]=[]),this.handleProductChange(e[a]);else if("funcKey"===t){var c;this.handleFuncChange(e[a]);var i=(null===(c=this.tasksData[s].filter((function(t){return t.funcKey==e[a].value})))||void 0===c?void 0:c.pop())||null;this.$set(this.selectData,"funcValue",i?i.funcValue:"")}else"funcValue"===t&&this.tasksData[s].forEach((function(t){t.funcKey==n.selectData.funcKey&&(t.funcValue=e[a].value)}))},inputChange:function(){var t=this;this.tasksData[this.selectData.productKey].forEach((function(e){e.funcKey==t.selectData.funcKey&&(e.funcValue=t.selectData.funcValue)}))},funcChange:function(t){var e=this,a=this.selectData.productKey,n=Object(i["a"])(this.tasksData[a]);this.tasksData[a]=t.map((function(t){var a,s=(null===(a=n.filter((function(e){return e.funcKey===t})))||void 0===a?void 0:a.pop())||null;if(s)return s;var c,i=(null===(c=e.lists.taskFuncList)||void 0===c||null===(c=c.filter((function(e){return e.dpId===t})))||void 0===c?void 0:c.pop())||{};return{funcKey:t,funcValue:e.setDefaultProp(i),funcCompare:2,funcIdentifier:i.identifier,funcDesc:i.name}}))},setDefaultProp:function(t){if("ENUM"===t.dataType||"FAULT"==t.dataType){var e=JSON.parse(t.dataSpecsList);return e[0].value}if("BOOL"===t.dataType){var a=JSON.parse(t.dataSpecsList);return a[0].name}if("INT"===t.dataType||"DOUBLE"==t.dataType||"FLOAT"==t.dataType){var n=JSON.parse(t.dataSpecs);return n.min}if("TEXT"===t.dataType)return""},getProductList:function(){var t=this;return Object(r["a"])(Object(u["a"])().mark((function e(){var a,n,s;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["A"])({page:0});case 2:if(a=e.sent,0===a.code){e.next=5;break}return e.abrupt("return");case 5:"edit"===t.type?t.lists.productList=(null===(n=a.data)||void 0===n||null===(n=n.list)||void 0===n||null===(n=n.filter((function(e){return e.productKey===t.data.productKey})))||void 0===n?void 0:n.map((function(t){var e=Object(c["a"])({},t),a=e.productKey,n=e.name,s=e.imageUrl,i=e.schemeId,u=e.id;return{value:a,label:n,image:s,schemeId:i,productId:u,productKey:a,productName:n}})))||[]:t.lists.productList=(null===(s=a.data)||void 0===s||null===(s=s.list)||void 0===s||null===(s=s.filter((function(e){var a;return!(null!==(a=t.originTaskList)&&void 0!==a&&a.some((function(t){return t.productKey===e.productKey})))})))||void 0===s?void 0:s.map((function(t){var e=Object(c["a"])({},t),a=e.productKey,n=e.name,s=e.imageUrl,i=e.schemeId,u=e.id;return{value:a,label:n,image:s,schemeId:i,productId:u,productKey:a,productName:n}})))||[];case 6:case"end":return e.stop()}}),e)})))()},handleProductChange:function(t,e){var a=this;return Object(r["a"])(Object(u["a"])().mark((function n(){var s,i,r,o,p;return Object(u["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.selectData.productId=t.productId,a.selectData.productName=t.productName,n.next=4,Object(l["F"])({productId:t.productId,condType:"execCond"});case 4:if(i=n.sent,0===i.code){n.next=7;break}return n.abrupt("return");case 7:r=(null===(s=i.data)||void 0===s?void 0:s.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{value:t.dpId,label:t.name})})))||[],a.$set(a.lists,"taskFuncList",r),e&&(p=(null===(o=a.lists.taskFuncList)||void 0===o||null===(o=o.filter((function(t){return t.dpId==a.selectData.funcKey})))||void 0===o?void 0:o.pop())||{},a.handleFuncChange(p));case 10:case"end":return n.stop()}}),n)})))()},handleFuncChange:function(t){if("ENUM"===t.dataType||"FAULT"==t.dataType){var e=JSON.parse(t.dataSpecsList),a=e.map((function(t){return{label:t.desc,value:t.value}}));this.colList[2].type="select",this.$set(this.lists,"propsList",a)}else if("BOOL"===t.dataType){var n=JSON.parse(t.dataSpecsList),s=n.map((function(t){return{label:t.desc,value:t.name}}));this.colList[2].type="select",this.$set(this.lists,"propsList",s)}else"INT"===t.dataType||"DOUBLE"==t.dataType||"FLOAT"==t.dataType?(this.numRange=JSON.parse(t.dataSpecs),this.colList[2].type="numberInput",this.$set(this.lists,"propsList",this.$DictList("operational_character"))):"TEXT"===t.dataType&&(this.numRange=JSON.parse(t.dataSpecs),this.colList[2].type="textInput")},handleOk:function(){var t=this;return Object(r["a"])(Object(u["a"])().mark((function e(){var a,n,s,c;return Object(u["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectData.productKey){e.next=3;break}return t.$emit("handleOk",Object(i["a"])(t.originTaskList)),e.abrupt("return");case 3:a={},t.tasksCheck[t.selectData.productKey]&&t.tasksCheck[t.selectData.productKey].length>0?(a={productId:t.selectData.productId,productKey:t.selectData.productKey,functions:(null===(n=t.tasksData[t.selectData.productKey])||void 0===n?void 0:n.map((function(e){var a,n=(null===(a=t.lists.taskFuncList)||void 0===a||null===(a=a.filter((function(t){return t.dpId==e.funcKey})))||void 0===a?void 0:a.pop())||{};return{funcKey:"".concat(e.funcKey),funcCompare:2,funcValue:"".concat(e.funcValue)||"".concat(t.selectData.funcValue),funcIdentifier:n.identifier,funcDesc:n.name}})))||[]},s=t.originTaskList.findIndex((function(t){return t.productKey===a.productKey})),-1!==s?t.originTaskList.splice(s,1,a):0!==a.functions.length&&t.originTaskList.push(a)):(c=t.originTaskList.findIndex((function(e){return e.productKey===t.selectData.productKey})),-1!==c&&t.originTaskList.splice(c,1)),t.$emit("handleOk",Object(i["a"])(t.originTaskList));case 6:case"end":return e.stop()}}),e)})))()},handleCancel:function(){this.$emit("handleCancel")}}}),p=o,d=(a("f57b"),a("2877")),f=Object(d["a"])(p,n,s,!1,null,"dcfced1e",null);e["default"]=f.exports},6027:function(t,e,a){},f57b:function(t,e,a){"use strict";a("6027")}}]);