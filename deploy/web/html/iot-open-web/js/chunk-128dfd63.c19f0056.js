(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-128dfd63"],{"3cb2":function(e,t,a){"use strict";a.r(t);a("a9e3");var n=function(){var e=this,t=e._self._c;return t("a-modal",{attrs:{title:e.getTitle,width:800,visible:e.visible,"confirm-loading":e.confirmLoading},on:{cancel:e.handleCancel}},[t("a-spin",{attrs:{spinning:e.confirmLoading}},[t("a-form-model",{ref:"formData",staticClass:"regular-form",attrs:{model:e.formData,rules:e.rules,"label-col":{span:4},"wrapper-col":{span:20}}},[t("a-form-model-item",{attrs:{label:e.$t("setting.ruleConfig.columns.ruleName"),prop:"ruleName"}},[t("a-input",{staticClass:"rule-name",attrs:{disabled:"check"==e.type,maxLength:50},model:{value:e.formData.ruleName,callback:function(t){e.$set(e.formData,"ruleName",t)},expression:"formData.ruleName"}})],1),t("a-form-model-item",{attrs:{label:e.$t("setting.ruleConfig.columns.conditionType"),prop:"conditionType"}},[t("a-radio-group",{attrs:{disabled:"check"==e.type,options:e.$DictList("rule_condition_type")},model:{value:e.formData.conditionType,callback:function(t){e.$set(e.formData,"conditionType",t)},expression:"formData.conditionType"}})],1),t("a-form-model-item",{attrs:{label:e.$t("setting.ruleConfig.columns.if"),prop:"ifSpecs"}},e._l(e.formData.ifSpecs,(function(a,n){return t("a-row",{key:n,attrs:{gutter:20,type:"flex",align:"middle"}},[t("a-col",{attrs:{xs:24,md:7}},[t("a-select",{attrs:{disabled:"check"==e.type,options:e.funcOptions,placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.funcIfChange(a.dpId,n)}},model:{value:a.dpId,callback:function(t){e.$set(a,"dpId",t)},expression:"item.dpId"}})],1),a.dpId?t("a-col",{attrs:{xs:24,md:5}},[t("a-select",{attrs:{disabled:"check"==e.type,options:e.ifOperateOptions[e.dataSource[a.dpId].dataType],placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.dataChange("ifSpecs",n,"operate",t)}},model:{value:a.operate,callback:function(t){e.$set(a,"operate",t)},expression:"item.operate"}})],1):e._e(),a.operate&&5!=a.operate?t("a-col",{attrs:{xs:24,md:7}},["BOOL"==e.dataSource[a.dpId].dataType||"ENUM"==e.dataSource[a.dpId].dataType?t("a-select",{attrs:{disabled:"check"==e.type,options:e.dataSource[a.dpId].dataSpecsList,placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.dataChange("ifSpecs",n,"value",t)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"TEXT"==e.dataSource[a.dpId].dataType?t("a-input",{attrs:{disabled:"check"==e.type},on:{input:function(t){return e.dataChange("ifSpecs",n,"value",a.value)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"INT"==e.dataSource[a.dpId].dataType||"FLOAT"==e.dataSource[a.dpId].dataType||"DOUBLE"==e.dataSource[a.dpId].dataType?t("a-input-number",{attrs:{disabled:"check"==e.type,min:Number(e.dataSource[a.dpId].dataSpecs.min),max:Number(e.dataSource[a.dpId].dataSpecs.max),step:Number(e.dataSource[a.dpId].dataSpecs.step),precision:"INT"==e.dataSource[a.dpId].dataSpecs.dataType?0:3},on:{change:function(t){return e.dataChange("ifSpecs",n,"value",t)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e()],1):e._e(),"check"!==e.type?t("a-col",{attrs:{xs:6,md:3}},[t("div",{staticClass:"flex y-axis-center x-space-between"},[t("span",{staticClass:"flex xy-axis-center",on:{click:e.handleAddIf}},[t("icon-font",{staticStyle:{color:"#3b7cff","font-size":"24px"},attrs:{type:"icon-zengjia"}})],1),e.formData.ifSpecs.length>1?t("span",{staticClass:"flex xy-axis-center",on:{click:function(t){return e.handleDeleteIf(n)}}},[t("icon-font",{staticStyle:{color:"#70757D","font-size":"24px"},attrs:{type:"icon-jianshao"}})],1):e._e()])]):e._e()],1)})),1),t("a-form-model-item",{attrs:{label:e.$t("setting.ruleConfig.columns.then"),prop:"thenSpecs"}},e._l(e.formData.thenSpecs,(function(a,n){return t("a-row",{key:n,attrs:{gutter:20,type:"flex",align:"middle"}},[t("a-col",{attrs:{xs:24,md:7}},[t("a-select",{attrs:{disabled:"check"==e.type,options:e.funcOptions,placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.funcThenChange(a.dpId,n)}},model:{value:a.dpId,callback:function(t){e.$set(a,"dpId",t)},expression:"item.dpId"}})],1),a.dpId?t("a-col",{attrs:{xs:24,md:5}},[t("a-select",{attrs:{disabled:"check"==e.type,options:e.$DictList("rule_then_operation"),placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.dataChange("thenSpecs",n,"operate",t)}},model:{value:a.operate,callback:function(t){e.$set(a,"operate",t)},expression:"item.operate"}})],1):e._e(),a.operate&&1==a.operate?t("a-col",{attrs:{xs:24,md:7}},["BOOL"==e.dataSource[a.dpId].dataType||"ENUM"==e.dataSource[a.dpId].dataType?t("a-select",{attrs:{disabled:"check"==e.type,options:e.dataSource[a.dpId].dataSpecsList,placeholder:e.$t("setting.ruleConfig.placeholder")},on:{change:function(t){return e.dataChange("thenSpecs",n,"value",t)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"TEXT"==e.dataSource[a.dpId].dataType?t("a-input",{attrs:{disabled:"check"==e.type},on:{change:function(t){return e.dataChange("thenSpecs",n,"value",a.value)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e(),"INT"==e.dataSource[a.dpId].dataType||"FLOAT"==e.dataSource[a.dpId].dataType||"DOUBLE"==e.dataSource[a.dpId].dataType?t("a-input-number",{attrs:{disabled:"check"==e.type,min:Number(e.dataSource[a.dpId].dataSpecs.min),max:Number(e.dataSource[a.dpId].dataSpecs.max),step:Number(e.dataSource[a.dpId].dataSpecs.step),precision:"INT"==e.dataSource[a.dpId].dataSpecs.dataType?0:3},on:{change:function(t){return e.dataChange("thenSpecs",n,"value",t)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}}):e._e()],1):e._e(),"check"!==e.type?t("a-col",{attrs:{xs:6,md:3}},[t("div",{staticClass:"flex y-axis-center x-space-between"},[t("span",{staticClass:"flex xy-axis-center",on:{click:e.handleAddThen}},[t("icon-font",{staticStyle:{color:"#3b7cff","font-size":"24px"},attrs:{type:"icon-zengjia"}})],1),e.formData.thenSpecs.length>1?t("span",{staticClass:"flex xy-axis-center",on:{click:function(t){return e.handleDeleteThen(n)}}},[t("icon-font",{staticStyle:{color:"#70757D","font-size":"24px"},attrs:{type:"icon-jianshao"}})],1):e._e()])]):e._e()],1)})),1)],1)],1),t("template",{slot:"footer"},[t("a-button",{key:"back",on:{click:e.handleCancel}},[e._v(e._s("check"==e.type?e.$t("public.close.text"):e.$t("public.cancel")))]),"check"!==e.type?t("a-button",{key:"submit",attrs:{type:"primary"},on:{click:e.handleOk}},[e._v(e._s(e.$t("public.sumit")))]):e._e()],1)],2)},i=[],r=a("c7eb"),l=a("5530"),c=a("1da1"),o=(a("a434"),a("d3b7"),a("99af"),a("ca00")),s=a("c3fb"),d={name:"EditRule",props:{visible:{type:Boolean,default:!1},type:{type:String,default:"add"},productId:{type:String,default:""},productKey:{type:String,default:""},detail:{type:Object,default:function(){}},funcOptions:{type:Array,default:function(){return[]}},dataSource:{type:Object,default:function(){}},dataOrigin:{type:Number,default:1}},data:function(){return{confirmLoading:!1,formData:{ifSpecs:[{}],thenSpecs:[{}]},rules:{ruleName:[{required:!0,message:this.$t("setting.ruleConfig.columns.ruleName.rule"),trigger:"change"}],conditionType:[{required:!0,message:this.$t("setting.ruleConfig.columns.ruleName.conditionType"),trigger:"change"}],ifSpecs:[{required:!0,message:this.$t("setting.ruleConfig.columns.if.rule"),trigger:"change"},{validator:this.ifValidator,trigger:"change"}],thenSpecs:[{required:!0,message:this.$t("setting.ruleConfig.columns.then.rule"),trigger:"change"},{validator:this.thenValidator,trigger:"change"}]},ifOperateOptions:{BOOL:[{label:this.$t("public.equal"),value:1},{label:this.$t("public.arbitrary.value"),value:5}],INT:[{label:this.$t("public.greater.than"),value:3},{label:this.$t("public.equal"),value:1},{label:this.$t("public.less.than"),value:4},{label:this.$t("public.arbitrary.value"),value:5}],FLOAT:[{label:this.$t("public.greater.than"),value:3},{label:this.$t("public.equal"),value:1},{label:this.$t("public.less.than"),value:4},{label:this.$t("public.arbitrary.value"),value:5}],DOUBLE:[{label:this.$t("public.greater.than"),value:3},{label:this.$t("public.equal"),value:1},{label:this.$t("public.less.than"),value:4},{label:this.$t("public.arbitrary.value"),value:5}],ENUM:[{label:this.$t("public.equal"),value:1},{label:this.$t("public.unequal"),value:2},{label:this.$t("public.arbitrary.value"),value:5}],TEXT:[{label:this.$t("public.equal"),value:1}]}}},computed:{getTitle:function(){return"add"==this.type?this.$t("setting.ruleConfig.addRule.btn"):"edit"==this.type?this.$t("setting.ruleConfig.editRule.btn"):"check"==this.type?this.$t("setting.ruleConfig.checkRule.btn"):void 0}},watch:{visible:function(e){var t=this;return Object(c["a"])(Object(r["a"])().mark((function a(){var n,i;return Object(r["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:null===(n=t.$refs.formData)||void 0===n||n.resetFields(),"add"!==t.type?(i=t.$deepClone(t.detail),t.formData=Object(l["a"])(Object(l["a"])({},i),{},{conditionType:"".concat(i.conditionType)})):t.formData={ifSpecs:[{dpId:null,operate:null,value:null}],thenSpecs:[{dpId:null,operate:null,value:null}],dataOrigin:t.dataOrigin};case 4:case"end":return a.stop()}}),a)})))()}},mounted:function(){},methods:{handleOk:function(){var e=this;this.$refs.formData.validate(function(){var t=Object(c["a"])(Object(r["a"])().mark((function t(a){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:if(e.confirmLoading=!0,"edit"!=e.type){t.next=9;break}return t.next=6,Object(s["c"])(Object(l["a"])(Object(l["a"])({},e.formData),{},{conditionType:Number(e.formData.conditionType),ifSpecs:JSON.stringify(e.formData.ifSpecs),thenSpecs:JSON.stringify(e.formData.thenSpecs)}));case 6:t.t0=t.sent,t.next=12;break;case 9:return t.next=11,Object(s["a"])(Object(l["a"])(Object(l["a"])({},e.formData),{},{conditionType:Number(e.formData.conditionType),ifSpecs:JSON.stringify(e.formData.ifSpecs),thenSpecs:JSON.stringify(e.formData.thenSpecs),productId:e.productId,productKey:e.productKey,status:2}));case 11:t.t0=t.sent;case 12:if(n=t.t0,e.confirmLoading=!1,0===n.code){t.next=16;break}return t.abrupt("return");case 16:e.$emit("handleOk");case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleCancel:function(){this.$emit("handleCancel")},handleAddIf:function(){this.formData.ifSpecs.push({})},handleDeleteIf:function(e){this.formData.ifSpecs.splice(e,1),this.handleValidate("ifSpecs"),this.handleValidate("thenSpecs")},funcIfChange:function(e,t){var a,n=this.dataSource[e];(this.formData.ifSpecs[t].operate||(this.formData.ifSpecs[t].operate=1),"ENUM"==n.dataType||"BOOL"==n.dataType)?this.formData.ifSpecs[t].value=(null===(a=n.dataSpecsList[0])||void 0===a?void 0:a.value)||0:"INT"!=n.dataType&&"FLOAT"!=n.dataType&&"DOUBLE"!=n.dataType||(this.formData.ifSpecs[t].value=n.dataSpecs.min);this.handleValidate("ifSpecs"),this.handleValidate("thenSpecs")},handleAddThen:function(){this.formData.thenSpecs.push({dpId:null,operate:null,value:null})},handleDeleteThen:function(e){this.formData.thenSpecs.splice(e,1),this.handleValidate("thenSpecs")},funcThenChange:function(e,t){var a,n=this.dataSource[e];(this.formData.thenSpecs[t].operate||(this.formData.thenSpecs[t].operate=1),"ENUM"==n.dataType||"BOOL"==n.dataType)?this.formData.thenSpecs[t].value=(null===(a=n.dataSpecsList[0])||void 0===a?void 0:a.value)||0:"INT"!=n.dataType&&"FLOAT"!=n.dataType&&"DOUBLE"!=n.dataType||(this.formData.thenSpecs[t].value=n.dataSpecs.min);this.handleValidate("thenSpecs")},handleValidate:function(e){var t;null===(t=this.$refs.formData)||void 0===t||t.validateField([e])},ifValidator:function(e,t,a){if(this.formData.ifSpecs.some((function(e){return Object(o["h"])(e.dpId)})))a(this.$t("setting.ruleConfig.columns.if.rule1"));else{var n={},i=!1;for(var r in this.formData.ifSpecs){var l=this.formData.ifSpecs[r];if(n[l.dpId]&&n[l.dpId]=="".concat(l.operate,"_").concat(l.value)){i=!0;break}5==l.operate?n[l.dpId]=5:n[l.dpId]="".concat(l.operate,"_").concat(l.value)}i?a(this.$t("setting.ruleConfig.if.noRepeat")):a()}},thenValidator:function(e,t,a){var n=this;if(this.formData.thenSpecs.some((function(e){return Object(o["h"])(e.dpId)})))a(this.$t("setting.ruleConfig.columns.then.rule1"));else{var i={},r=!1,l=!1,c=function(){var e=n.formData.thenSpecs[s];i[e.dpId]?r=!0:i[e.dpId]=!0,n.formData.ifSpecs.some((function(t){return t.dpId==e.dpId}))&&(l=!0)};for(var s in this.formData.thenSpecs)c();r&&a(this.$t("setting.ruleConfig.then.noRepeat")),l&&a(this.$t("setting.ruleConfig.if.then.noRepeat")),a()}},dataChange:function(e,t,a,n){var i=this.$deepClone(this.formData[e]);i[t][a]=n,this.$set(this.formData,e,i),this.handleValidate("ifSpecs"),this.handleValidate("thenSpecs")}}},u=d,p=(a("4f1a"),a("2877")),f=Object(p["a"])(u,n,i,!1,null,"8a9bd546",null);t["default"]=f.exports},"4f1a":function(e,t,a){"use strict";a("9059")},9059:function(e,t,a){},c3fb:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"a",(function(){return r})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return c})),a.d(t,"d",(function(){return o}));var n=a("b775");function i(e){return Object(n["b"])({url:"/v1/platform/web/open/product/ruleSetting/listByProductId",method:"get",params:e})}function r(e){return Object(n["b"])({url:"/v1/platform/web/open/product/ruleSetting/add",method:"post",data:e})}function l(e){return Object(n["b"])({url:"/v1/platform/web/open/product/ruleSetting/edit",method:"post",data:e})}function c(e){return Object(n["b"])({url:"/v1/platform/web/open/product/ruleSetting/delete/"+e,method:"post"})}function o(e){return Object(n["b"])({url:"/v1/platform/web/open/product/ruleSetting/setStatus",method:"post",data:e})}}}]);