(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30f82b36"],{"03d4":function(e,t,n){},"57bf":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e._self._c;return t("section",{staticClass:"page-wrap no-padding"},[t("a-page-header",{attrs:{title:e.$t("customRole.title")},on:{back:e.handleCancel}},[t("icon-font",{style:{fontSize:"24px"},attrs:{slot:"backIcon",type:"icon-back_arrow"},slot:"backIcon"}),t("section",{staticClass:"content"},[t("h4",[e._v(e._s(e.$t("customRole.title.type")))]),t("a-row",[t("a-col",{attrs:{md:8,sm:24}},[t("a-input",{attrs:{placeholder:e.$t("customRole.placeholder.roleName"),maxLength:50},model:{value:e.roleName,callback:function(t){e.roleName=t},expression:"roleName"}})],1)],1),e.showValidText?t("p",{staticClass:"valid-text"},[e._v(e._s(e.$t("customRole.placeholder.roleName")))]):e._e(),t("h4",[e._v(e._s(e.$t("customRole.menus.title")))]),t("section",{staticClass:"menu-tree"},[t("a-row",{attrs:{gutter:20}},e._l(e.treeData,(function(n,r){return t("a-col",{key:r,attrs:{md:6,sm:24}},[t("a-tree",{attrs:{checkable:"",checkStrictly:"",defaultExpandAll:"","tree-data":[n],replaceFields:{key:"id"}},on:{check:e.treeNodeCheck},model:{value:e.checkedKeys[r],callback:function(t){e.$set(e.checkedKeys,r,t)},expression:"checkedKeys[index]"}},[t("i",{attrs:{slot:"switcherIcon"},slot:"switcherIcon"},[t("arrow-down-icon")],1)])],1)})),1)],1),t("section",{staticClass:"action-wrap"},[t("a-space",{attrs:{size:20}},[t("a-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v(e._s(e.$t("public.save")))]),t("a-button",{on:{click:e.handleCancel}},[e._v(e._s(e.$t("public.cancel")))])],1)],1)],1)],1)],1)},a=[],c=n("2909"),o=n("c7eb"),u=n("1da1"),l=n("5530"),s=(n("d81d"),n("0481"),n("4069"),n("4de4"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("159b"),n("99af"),n("a434"),n("04b3")),i=n("fd85"),d=n("2f62"),h=n("ca00"),f={name:"CustomRole",components:{ArrowDownIcon:s["c"]},data:function(){return{roleName:"",checkedKeys:[],showValidText:!1,roleId:"",userName:"",treeData:[]}},computed:Object(l["a"])({},Object(d["c"])(["roles"])),mounted:function(){this.roleId=this.$route.query.roleId||"",this.userName=this.$route.query.userName||"",this.treeData=this.filterMenu(this.roles),this.roleId&&this.getRoleDetails()},methods:{getRoleDetails:function(){var e=this;return Object(u["a"])(Object(o["a"])().mark((function t(){var n;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["h"])({id:e.roleId});case 2:if(n=t.sent,0===n.code){t.next=5;break}return t.abrupt("return");case 5:if(e.roleName=n.data.roleName,n.data.menuIds&&0!==n.data.menuIds.length){t.next=8;break}return t.abrupt("return");case 8:e.checkedKeys=Object(h["e"])(e.treeData,n.data.menuIds,"id").map((function(e){return e.flat(2)}))||[];case 9:case"end":return t.stop()}}),t)})))()},handleSave:function(){var e=this;return Object(u["a"])(Object(o["a"])().mark((function t(){var n,r,a,u;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showValidText=!e.roleName,!e.showValidText){t.next=3;break}return t.abrupt("return");case 3:if(r=null,a=e.checkedKeys.map((function(e){var t;return null!==(t=e.checked)&&void 0!==t?t:e})),u=null!==(n=Object(c["a"])(new Set(a.flat())).filter((function(e){return null!==e})))&&void 0!==n?n:[],!e.roleId){t.next=12;break}return t.next=9,Object(i["f"])({roleName:e.roleName,menuIds:u,id:e.roleId});case 9:r=t.sent,t.next=15;break;case 12:return t.next=14,Object(i["b"])({roleName:e.roleName,menuIds:u});case 14:r=t.sent;case 15:if(0===r.code){t.next=17;break}return t.abrupt("return");case 17:e.$router.push({path:"/authority/authorization/index",query:{userName:e.userName,roleId:e.roleId||""}});case 18:case"end":return t.stop()}}),t)})))()},handleCancel:function(){this.$router.push({path:"/authority/authorization/index",query:{userName:this.userName,roleId:this.roleId||""}})},filterMenu:function(e){var t=this,n=[];return e.forEach((function(e){1==e.visible&&(e.children&&(e.children=t.filterMenu(e.children)),n.push(e))})),n},filterReleMenus:function(e,t){var n=this,r=[];return 1==t&&e.$parent.eventKey?(r=[e.eventKey,e.$parent.eventKey],r=[].concat(Object(c["a"])(r),Object(c["a"])(this.filterReleMenus(e.$parent,1)))):2==t&&e&&(r.push(e.id),e.children.forEach((function(e){r=[].concat(Object(c["a"])(r),Object(c["a"])(n.filterReleMenus(e,2)))}))),r},deleteReleMenus:function(e,t,n){var r=this,a=Object(c["a"])(e);if(1==n&&t.$parent.eventKey){var o=t.$parent.getNodeChildren(),u=!1;if(o.forEach((function(t){-1!=e.indexOf(t.key)&&(u=!0)})),!u){var l=a.indexOf(t.$parent.eventKey);-1!=l&&a.splice(l,1),a=this.deleteReleMenus(a,t.$parent,1)}}else 2==n&&t&&t.children.forEach((function(e){var t=a.indexOf(e.id);-1!=t&&a.splice(t,1),a=r.deleteReleMenus(a,e,2)}));return a},treeNodeCheck:function(e,t){var n=this;if(t.checked){var r=this.filterReleMenus(t.node,1);r=[].concat(Object(c["a"])(e.checked),Object(c["a"])(r));var a=t.node.getNodeChildren(),o=[];a.length&&a.forEach((function(e){o=[].concat(Object(c["a"])(o),Object(c["a"])(n.filterReleMenus(e.data.props.dataRef,2)))}));var u=[].concat(Object(c["a"])(r),Object(c["a"])(o));e.checked=Object(c["a"])(new Set(u))}else{var l=this.deleteReleMenus(e.checked,t.node,1);l=this.deleteReleMenus(l,t.node.dataRef,2),e.checked=Object(c["a"])(new Set(l))}}}},b=f,p=(n("e76b"),n("2877")),m=Object(p["a"])(b,r,a,!1,null,"3cd111c7",null);t["default"]=m.exports},e76b:function(e,t,n){"use strict";n("03d4")},fd85:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return u})),n.d(t,"i",(function(){return l})),n.d(t,"j",(function(){return s})),n.d(t,"h",(function(){return i})),n.d(t,"b",(function(){return d})),n.d(t,"f",(function(){return h})),n.d(t,"d",(function(){return f}));var r=n("b775");function a(e){return Object(r["b"])({url:"/v1/platform/web/open/auth/list",method:"get",params:e})}function c(e){return Object(r["b"])({url:"/v1/platform/web/open/auth/add",method:"post",data:e})}function o(e){return Object(r["b"])({url:"/v1/platform/web/open/auth/remark",method:"post",data:e})}function u(e){return Object(r["b"])({url:"/v1/platform/web/open/auth/delete",method:"post",data:e})}function l(e){return Object(r["b"])({url:"/v1/platform/web/open/role/list",method:"get",params:e})}function s(e){return Object(r["b"])({url:"/v1/platform/web/open/role/user",method:"post",data:e})}function i(e){return Object(r["b"])({url:"/v1/platform/web/open/role",method:"get",params:e})}function d(e){return Object(r["b"])({url:"/v1/platform/web/open/role",method:"post",data:e})}function h(e){return Object(r["b"])({url:"/v1/platform/web/open/role/update",method:"post",data:e})}function f(e){return Object(r["b"])({url:"/v1/platform/web/open/role/delete",method:"post",data:e})}}}]);